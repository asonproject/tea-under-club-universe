<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ワンコ通信 ジェネレーター（配置修正版）</title>
    <style>
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; text-align: center; background: #f6f6f6; padding: 20px; }
        .controls { background: white; padding: 25px; border-radius: 12px; display: inline-block; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid #eee; }
        input[type="text"] { width: 320px; padding: 12px; font-size: 16px; margin: 8px; border: 2px solid #ddd; border-radius: 6px; outline: none; }
        input[type="text"]:focus { border-color: #4CAF50; }
        button { padding: 12px 24px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 6px; font-weight: bold; margin: 5px; font-size: 16px; transition: 0.2s; }
        button:hover { background: #45a049; }
        #canvas-container { border: 1px solid #ccc; display: inline-block; background: #fff; line-height: 0; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        canvas { max-width: 100%; height: auto; }
        h2 { margin-top: 0; color: #333; }
    </style>
</head>
<body>

<div class="controls">
    <h2>ワンコ通信 作成ツール</h2>
    <p style="font-size:14px; color:#666;">① 元画像をアップロード → ② タイトル入力 → ③ 保存</p>
    <input type="file" id="bgUpload" accept="image/*"><br><br>
    <input type="text" id="line1" placeholder="タイトル1行目" value="成長とともに"><br>
    <input type="text" id="line2" placeholder="タイトル2行目" value="外れていくもの"><br><br>
    <button onclick="generateImage()">表示を更新</button>
    <button onclick="downloadImage()" style="background:#2196F3;">画像を保存する</button>
</div>

<div id="canvas-container">
    <canvas id="myCanvas"></canvas>
</div>

<script>
// 七十二候データ（2026年2月26日は「霞始靆」付近）
const kouData = [
    {n:"東風解凍", k:"はるかぜこおりをとく"}, {n:"黄鶯睍睆", k:"うぐいすなく"}, {n:"魚上氷", k:"うおこおりをいずる"},
    {n:"土脈潤起", k:"つちのしょううるおいおこる"}, {n:"霞始靆", k:"かすみはじめてたなびく"}, {n:"草木萌動", k:"そうもくめばえいずる"},
    {n:"啓蟄", k:"けいちつ"}, {n:"桃始笑", k:"ももはじめてわらう"}, {n:"倉庚鳴", k:"うぐいすなく"},
    {n:"玄鳥至", k:"つばめきたる"}, {n:"鴻雁北", k:"こうがんかえる"}, {n:"虹始見", k:"にじはじめてあらわる"},
    {n:"葭始生", k:"あしはじめてしょうず"}, {n:"霜止出苗", k:"しもやみてなえいづる"}, {n:"牡丹華", k:"ぼたんはなさく"},
    {n:"蚯蚓出", k:"みみずいづる"}, {n:"竹笋生", k:"たけのこしょうず"}, {n:"蚕起食桑", k:"かいこおきてくわをはむ"},
    {n:"小満", k:"しょうまん"}, {n:"紅花栄", k:"べにばなさく"}, {n:"麦秋至", k:"むぎのときいたる"},
    {n:"蟷螂生", k:"かまきりしょうず"}, {n:"腐草為蛍", k:"くされたるくさほたるとなる"}, {n:"梅子黄", k:"うめのみきばむ"},
    {n:"夏至", k:"げし"}, {n:"乃東枯", k:"なつかれくさかる"}, {n:"菖蒲華", k:"あやめはなさく"},
    {n:"温風至", k:"あつかぜいたる"}, {n:"蓮始開", k:"はすはじめてひらく"}, {n:"鷹乃学習", k:"たかすなわちわざをならう"},
    {n:"大暑", k:"たいしょ"}, {n:"桐始結花", k:"きりははじめてはなをむすぶ"}, {n:"土潤溽暑", k:"つちうるおうてむしあつし"},
    {n:"大雨時行", k:"たいうときどきふる"}, {n:"涼風至", k:"すずかぜいたる"}, {n:"寒蝉鳴", k:"ひぐらしなく"},
    {n:"立秋", k:"りっしゅう"}, {n:"蒙霧升降", k:"ふかききりまつおう"}, {n:"綿柎開", k:"わたのはなしべひらく"},
    {n:"草露白", k:"くさのつゆしろし"}, {n:"鶺鴒鳴", k:"せきれいなく"}, {n:"玄鳥去", k:"つばめさる"},
    {n:"白露", k:"はくろ"}, {n:"群鳥養羞", k:"むらとりじをたくわえる"}, {n:"雷乃収声", k:"かみなりすなわちこえをおさめる"},
    {n:"鴻雁来", k:"こうがんきたる"}, {n:"菊花開", k:"きくのはなひらく"}, {n:"蟋蟀在戸", k:"きりぎりすとにあり"},
    {n:"寒露", k:"かんろ"}, {n:"霜始降", k:"しもはじめてふる"}, {n:"霎時施", k:"こさめときどきふる"},
    {n:"山茶始開", k:"つばきはじめてひらく"}, {n:"地始凍", k:"ちはじめてこおる"}, {n:"金盞香", k:"きんせんかさく"},
    {n:"立冬", k:"りっとう"}, {n:"朔風払葉", k:"きたかぜこのはをはらう"}, {n:"橘始黄", k:"たちばなはじめてきばむ"},
    {n:"閉塞成冬", k:"そらさむくふゆとなる"}, {n:"鹿角解", k:"しかのつのおつる"}, {n:"雪下出麦", k:"ゆきわたりてむぎのびる"},
    {n:"小雪", k:"しょうせつ"}, {n:"芹乃栄", k:"せりすなわちさかう"}, {n:"水泉動", k:"しみずあたたかをふくむ"},
    {n:"雉始雊", k:"きじはじめてなく"}, {n:"款冬華", k:"ふきのはなはなさく"}, {n:"水沢腹堅", k:"さわみずこおりつめる"},
    {n:"大寒", k:"たいしょ"}, {n:"鶏始乳", k:"にわとりはじめてとやにつく"}, {n:"征鳥厲疾", k:"せいちょうはげしくすばやし"},
    {n:"東風解凍", k:"はるかぜこおりをとく"}
];

function getKouInfo() {
    const now = new Date();
    const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
    const index = Math.floor(dayOfYear / 5.07) % 72;
    return { name: kouData[index].n, kana: kouData[index].k, num: index + 1 };
}

const canvas = document.getElementById('myCanvas');
const ctx = canvas.getContext('2d');
let bgImg = new Image();

document.getElementById('bgUpload').onchange = function(e) {
    const reader = new FileReader();
    reader.onload = function(event) {
        bgImg.src = event.target.result;
        bgImg.onload = () => generateImage();
    };
    reader.readAsDataURL(e.target.files[0]);
};

function drawTextWithOutline(text, x, y, fontSize, color, hasShadow=true) {
    ctx.font = `bold ${fontSize}px sans-serif`;
    ctx.textAlign = "center"; // センタリング設定
    
    if(hasShadow) {
        ctx.shadowColor = "rgba(0,0,0,0.4)";
        ctx.shadowBlur = 8;
        ctx.shadowOffsetX = 4;
        ctx.shadowOffsetY = 4;
    }

    ctx.strokeStyle = "white";
    ctx.lineWidth = fontSize * 0.15;
    ctx.strokeText(text, x, y);

    ctx.shadowColor = "transparent";
    ctx.fillStyle = color;
    ctx.fillText(text, x, y);
}

function generateImage() {
    if (!bgImg.src) return;
    canvas.width = bgImg.width;
    canvas.height = bgImg.height;
    ctx.drawImage(bgImg, 0, 0);
    
    const kou = getKouInfo();
    const centerX = canvas.width / 2;

    // --- 七十二候エリア ---
    const kouY = canvas.height * 0.25;
    const kouFontSize = canvas.width * 0.055;
    const kanaFontSize = kouFontSize * 0.35;

    ctx.textAlign = "center";
    ctx.fillStyle = "white";
    
    // ふりがな描画
    ctx.font = `bold ${kanaFontSize}px sans-serif`;
    ctx.fillText(kou.kana, centerX, kouY - kouFontSize * 0.85);

    // 候本体の描画
    ctx.font = `bold ${kouFontSize}px sans-serif`;
    ctx.fillText(`〜 第${kou.num}候「${kou.name}」 〜`, centerX, kouY);

    // --- タイトルエリア（行間を詰める） ---
    const line1 = document.getElementById('line1').value;
    const line2 = document.getElementById('line2').value;
    const titleSize = canvas.width * 0.10; // 少し大きく
    
    // 行間の調整：1行目と2行目の距離を近づける
    const line1Y = canvas.height * 0.45;
    const lineGap = titleSize * 1.1; // 行間をフォントサイズの1.1倍に（以前より詰めました）
    
    drawTextWithOutline(line1, centerX, line1Y, titleSize, "#e60000");
    if(line2) {
        drawTextWithOutline(line2, centerX, line1Y + lineGap, titleSize, "#e60000");
    }
}

function downloadImage() {
    if (!bgImg.src) { alert("画像をアップロードしてください"); return; }
    const link = document.createElement('a');
    link.download = `wanko_image.png`;
    link.href = canvas.toDataURL("image/png");
    link.click();
}
</script>
</body>
</html>
