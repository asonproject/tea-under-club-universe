

## 概要
* **ファイルパス:** `【Layer 2】studio ← 価値を作る（制作工房）/06_publish/tea-under-club-universe/wanko.html`
* **バージョン:** v1.3.0
* **目的:** 指定した画像（デフォルトまたはユーザーアップロード）の上に、「ふりがな」「七十二候」「自由に編集できるタイトル」「お知らせ枠」などのテキスト要素を配置し、オリジナルの告知用画像を生成・ダウンロードできるツール。

---

## 主な機能と実装履歴

### ベース機能（v1.0 - v1.2）
* **Canvas画像合成:** HTML5 Canvasを用いたベース機能の実装。画像上の任意の位置にテキストを描き込み、1枚の画像（PNG形式）としてエクスポート。
* **各パーツ独立移動モード (v1.2):** 「ふりがな」「七十二候」「タイトル(2行)」「お知らせ枠」をそれぞれ個別にドラッグして自由に動かせる操作性を実現。
* **お知らせ枠:** ON/OFFのトグル機能、および複数行のテキスト表示機能の実装。

### UI/UXの改善と機能強化（v1.3 - 今回のアップデート内容）

本バージョンでは、より実用的で直感的に使いやすいジェネレーターを目指して複数の機能追加とデザイン調整を行いました。

#### 1. 初期プレビュー表示の自動化
* ページを開いた瞬間に、初期画像として `assets/wanko-moto.jpg` が自動で読み込まれてプレビューされるよう変更。（初手から手動で画像をアップロードする手間を省略）

#### 2. プレビュー画面サイズの最適化
* キャンバス（プレビュー画像）が画面全体に大きく表示されすぎて作業しにくかった問題を解消。
* CSSを調整し、**画面上の表示サイズを画面幅の50%（最大幅800px）** に縮小。
* ※表示のみを縮小しているため、ダウンロードして保存される実際の画像は「元の高い解像度」を保ったまま出力される設計。

#### 3. 七十二候（季節の言葉）の自動判定とプルダウン
* **正しいデータへの修正:** 1〜72候までの「名称」「ふりがな」を、ご提供いただいた正しいテキストリスト（「第7候 蟄虫啓戸」など）にすべて差し替え。
* **日付連動機能:** リストに含まれる「2/4～2/8頃」などの日付範囲を動的に計算。システムの日付（現在の「月・日」）と照らし合わせ、自動的に現在の候を特定するロジックを実装。
* **前後3候のプルダウン:** 全72個ではなく、「現在特定した候」を中心として「前後3つ（計7個）」だけをプルダウンに表示するように絞り込み、季節外れの言葉を誤って選ぶ確率を低減。

#### 4. 文字描画の最適化・デザイン強化
* **漢数字への変換:** 画像に描画される候の数字を、内部データの算用数字（第2候）から、より格式のある「漢数字（第二候）」に自動変換して書き込む処理を追加。
* **中央揃えのロック機能:** 「七十二候」と「タイトル」をドラッグする際、横方向（X軸）は常に画像の中央にぴったりフィットするようにロック。上下（Y軸）の高さのみを調整できるように制限し、文字が左右にズレるストレスを解消。
* **タイトルの影の強調:** タイトルのテキストシャドウを濃いオレンジ色（#FF4500）に強め、縁取りをはっきりさせることで視認性を向上。

#### 5. テキストサイズの柔軟なカスタマイズ機能
ユーザーがそれぞれのパーツの大きさを微調整できるよう、以下のスライダー（レンジ入力）を追加・改良。
* **タイトルの行間調整:** 1行目と2行目の間のスペースを調整。
* **タイトル1行目の文字サイズ:** 0.3倍〜2.0倍でスケーリング設定可能。
* **タイトル2行目の文字サイズ:** 0.3倍〜2.0倍でスケーリング設定可能。（1行目とは独立して「2行目だけ」を大きくするなどの自由なレイアウトが可能）
* **お知らせ枠の文字サイズ:** 枠内の情報量に応じて文字サイズを柔軟に変更可能。

#### 6. お知らせ枠のデザイン改善
* 背景色を「半透明の黄色（イエロー）」に変更し、目立たせつつも背景の画像が少し透けて見えるように調整。
* 黒い単色の枠線を削除し、モダンでスッキリとしたフラットデザインにリファイン。

---

## 既知の課題・今後のタスク
* **GitHub Pagesへのデプロイ:** 
現在の環境（macOS上）において、GitHubのプッシュ時に `403 Permission Denied` エラーが発生中。
リモートリポジトリ（`asonproject`）とローカルで認証しているユーザーアカウント（`sady225`）のアクセス権限（パーミッション）の不一致が原因。アカウントを切り替えるか、トークン等を再設定した上で再度 `git push` を行う必要がある。

---

## 今後の改善・開発提案

さらにジェネレーターをリッチに、かつ使いやすく進化させる場合のアイデア一覧です。

### 1. UI/UX・機能拡張のアイデア
* **細かなデザインカスタマイズ機能:** 
  文字色や影（シャドウ）のカラーをユーザー自身が選べるカラーピッカーの導入。フォント（明朝体・ゴシック体など）の切り替え機能。
* **画像のトリミング・拡大縮小（クロップ機能）:** 
  アップロードした元画像の「どの部分を切り取って使うか」をツール上で調整できる機能を追加（現状は画像全体がキャンバス化されるため）。
* **設定の自動保存（レジューム機能）:** 
  ブラウザの `localStorage` などを活用して、入力したタイトルやお知らせ枠のテキスト、位置情報を一時保存。間違ってページを閉じても作業を再開できるようにする。
* **スマホ操作の最適化・レスポンシブ対応強化:** 
  モバイル端末のタッチ操作において、重なっている要素（テキスト同士など）を選択・移動しやすくするための「レイヤー選択パネル」UIの導入。

### 2. コンテンツ・テンプレートの拡張
* **複数パターンのレイアウト保存:** 
  「横長バナー用」「Instagram正方形用」などキャンバスの縦横比（アスペクト比）の固定設定機能。
* **スタンプやロゴの配置機能:** 
  テキストだけでなく、団体のロゴ画像やアイコン（スタンプ）をアップロードして、好きな位置に配置できる機能。

---

## セキュリティ対策について

本ツール（v1.3.0時点）の設計上の強みと、今後の運用で考慮すべきセキュリティ対策です。

### 1. 現在のアーキテクチャの強み（プライバシー面での安全性）
* **完全なクライアントサイド（ブラウザ）完結処理:** 
  画像の読み込みから合成、ダウンロードまで、すべてユーザーのブラウザ・端末上（JavaScript / HTML5 Canvas）だけで処理されています。
* **サーバーへのアップロード・情報漏洩ゼロ:** 
  アップロードしたお子様の写真や入力したテキストデータは、外部サーバーに一切送信されません。そのため、個人情報の流出や不正アクセスのリスクが本質的に存在せず、非常に安全に利用してもらえます。

### 2. 今後推奨されるセキュリティ・堅牢化対策
* **CSP（Content Security Policy）の設定:** 
  外部の未認可スクリプトが誤って実行されないように、HTML内（`<meta>` タグ、またはサーバー側）でコンテンツセキュリティポリシーを導入し、悪意のあるスクリプト挿入（XSS対策など）をより強固に防ぐ。
* **入力値の無害化（サニタイズ）徹底:** 
  現在はCanvasへの描画（`ctx.fillText`）のみであるためXSSリスクは極めて低いですが、将来的に「入力された文字をHTML内にそのままプレビュー表示する」といった拡張を行う場合は、必ずエスケープ（タグの無効化）処理を組み込む必要があります。
* **アップロードファイルの検証強化:** 
  `accept="image/*"` を指定していますが、実際のJS側でも読み込む際に純粋な画像ファイルかどうかのMIMEタイプ検証を行うと、万が一の予期せぬエラーやブラウザクラッシュを未然に防げます。
